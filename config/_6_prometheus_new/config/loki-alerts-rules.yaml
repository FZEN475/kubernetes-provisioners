groups:
  - name: should_fire
    rules:
      - alert: HighPercentageError
        expr: |
          sum(rate({pod=~".+"} |~ "(?i)error" [5m])) by (pod) / sum(rate({pod=~".+"}[5m])) by (pod) > 0.05
        for: 1m
        labels:
          severity: "critical"
          namespace: "monitoring"
        annotations:
          summary: High request Error latency
      - alert: HighPercentageWarn
        expr: |
          sum(rate({pod=~".+"} |~ "(?i)warn" [5m])) by (pod) / sum(rate({pod=~".+"}[5m])) by (pod) > 0.05
        for: 1m
        labels:
          severity: "critical"
          namespace: "monitoring"
        annotations:
          summary: High request Warn latency
      - alert: HighPercentageDEBUG
        expr: |
          sum(rate({pod=~".+"} |~ "(?i)debug" [5m])) by (pod) / sum(rate({pod=~".+"}[5m])) by (pod) > 0.05
        for: 1m
        labels:
          severity: "warning"
          namespace: "monitoring"
        annotations:
          summary: High request DEBUG latency

  
#  - name: logs-error-warn-alerts
#    rules:
#      # ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ 1: ÐÐ»ÐµÑ€Ñ‚ Ð¿Ñ€Ð¸ >10 Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð·Ð° 5 Ð¼Ð¸Ð½ÑƒÑ‚
#      - alert: HighErrorRate
#        expr: |
#          sum(count_over_time({namespace=~".+"} |= `error` [30m])) > bool 1
#        for: 1m  # Ð”ÐµÑ€Ð¶Ð°Ñ‚ÑŒÑÑ 1 Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ Ð¿ÐµÑ€ÐµÐ´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹
#        labels:
#          severity: "critical"
#          namespace: "monitoring"  # Ð§Ñ‚Ð¾Ð±Ñ‹ Alertmanager Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð² Telegram
#        annotations:
#          summary: "High ERROR log rate ({{ $value }} lines in 5m)"
#          description: |
#            ðŸš¨ More than 10 ERROR logs in 5 minutes.
#            **Job:** {{ $labels.job }}
#            **Namespace:** {{ $labels.namespace | default "unknown" }}
#
#      # ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ 2: ÐÐ»ÐµÑ€Ñ‚ Ð¿Ñ€Ð¸ >30 Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸ÑÑ… Ð·Ð° 5 Ð¼Ð¸Ð½ÑƒÑ‚
#      - alert: HighWarnRate
#        expr: |
#          sum(count_over_time({namespace=~".+"} |= `warn` [30m])) > bool 1
#        for: 1m
#        labels:
#          severity: "warning"
#          namespace: "monitoring"
#        annotations:
#          summary: "High WARN log rate ({{ $value }} lines in 5m)"
#          description: |
#            âš  More than 30 WARN logs in 5 minutes.
#            **Job:** {{ $labels.job }}
#            **Namespace:** {{ $labels.namespace | default "unknown" }}
            
            
#
#            sum(rate({namespace=".+"} |= "error" [5m])) by (job)
#                        /
#                      sum(rate({namespace=".+" }[5m])) by (job)
#                        > 0.00